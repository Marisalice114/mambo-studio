# 项目总体构建
## 1.总体构建
lombok,mysql,hutool,springboot dev,knife4j(openai3)
## 2.基础代码
healthcontroller，(接口指定packages-to-scan)，aop引入
## 3.通用代码
common:BaseResponse,DeleteRequest,PageRequest,ResultUtil,
exception:GlobalExceptionHandler,BusinessException,ErrorCode,ThrowUtil
## 4.跨域配置
config:CorsConfig

# 用户部分
## 1.需求分析
注册
登录
获取当前登录用户
注销
权限控制:普通用户，管理员
管理:管理员管理普通用户，可搜索，删除
## 2.方案设计
库表设计:user
## 3.用户登录流程
建立初始session: 前端和服务器建立连接，服务器给其一个匿名唯一session，记录其状态
登录成功，更新session信息: 前端发送账号和密码给后端，后端验证成功过后，更新该session，将账号密码保存在session中
并且生成一个set-cookie的响应头，让前端将sessionid保存到cookie中
前端保存cookie: 前端接收到set-cookie响应头后，将sessionid保存到浏览器的cookie中
带cookie的后续请求: 后续前端发送请求时，浏览器会自动将cookie中的sessionid带上
后端会话验证: 后端根据前端的cookie中的sessionid，来找到对应的session
获取会话存储信息: 后端通过session来获取用户信息(权限，登录名)，识别身份执行逻辑
## 4.用户权限控制
四种:未登录也可使用，登录后才能使用，未登录也可用但是登录后功能更多，管理员才能使用
基于aop切面和自定义权限校验 aop切面实现同一拦截后进行权限校验
## 5.mybatis-flex
在 mybatis-flex 中，有了一个名称为 mybatis-flex-codegen 的模块，提供了可以通过数据库表，生成代码的功能。
当我们把数据库表设计完成后， 就可以使用其快速生成 Entity、 Mapper、 Service、 Controller 等产物。
配置依赖后，基于mybatis-flex-codegen的代码生成器，生成用户相关的代码
Entity Mapper Service ServiceImpl Controller MapperXml 等
注意生成后可以进行适当的修改 主键自增+雪花算法 角色定义枚举类
## 6.用户注册
为每一个接口定义一个类来接收参数来提高代码可读性
注册过程
1.输入内容校验
2.检查是否重复
3.密码加密 (hutool的bcrypt加密，自定义盐值)
4.插入内容

## 7.用户登录
注意这些接口都需要返回已登录的用户信息，并且不能将查到的信息全部返回，
返回给前端的信息需要建立vo类
从http请求中获取用户，先从session中获取用户id，然后根据用户id来查找结果
因为要更新session，更新session的一种方式就是传request
注意一定要在流程中实现一次脱敏

## 8.用户注销
用户注销的流程就是删除session中的登录态

## 9.用户权限控制
aop切面实现同一拦截后进行权限校验
1.权限校验注解 authcheck
2.权限校验切面 authinterceptor
此处设置五种状态

## 10用户管理
管理员curd部分
全局解决精度丢失:jsonconfig
如果雪花算法id生成过大，可能导致浏览器网页预览界面精度处理出现异常
```aiignore
/**
 * Spring MVC Json 配置
 */
@JsonComponent
public class JsonConfig {

    /**
     * 添加 Long 转 json 精度丢失的配置
     */
    @Bean
    public ObjectMapper jacksonObjectMapper(Jackson2ObjectMapperBuilder builder) {
        ObjectMapper objectMapper = builder.createXmlMapper(false).build();
        SimpleModule module = new SimpleModule();
        module.addSerializer(Long.class, ToStringSerializer.instance);
        module.addSerializer(Long.TYPE, ToStringSerializer.instance);
        objectMapper.registerModule(module);
        return objectMapper;
    }
}
```
注意 spring组件都为实例方法，想进行调用需要通过雨来注入来获取实例