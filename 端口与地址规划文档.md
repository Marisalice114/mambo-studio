# Mambo AI Platform - 端口与地址规划文档

## 📋 概述

本文档详细记录了 Mambo AI Platform 项目中所有服务的端口使用情况、数据库配置信息以及前后端地址规划，确保服务间的正确通信和部署配置。

---

## 🚀 核心服务端口规划

### 应用主服务

| 服务名称 | 端口 | 协议 | 用途 | 配置文件 |
|---------|------|------|------|----------|
| **Spring Boot 后端服务** | `8234` | HTTP | 主应用服务器 | `application.yml` |
| **Vue 3 前端开发服务** | `5173` | HTTP | Vite 开发服务器 (默认) | `vite.config.ts` |

### 数据存储服务

| 服务名称 | 端口 | 协议 | 用途 | 连接配置 |
|---------|------|------|------|----------|
| **MySQL 数据库** | `3306` | TCP | 主数据库 | `localhost:3306` |
| **Redis 缓存** | `6379` | TCP | 缓存/会话存储 | `localhost:6379` |

### 监控服务

| 服务名称 | 端口 | 协议 | 用途 | 配置文件 |
|---------|------|------|------|----------|
| **Prometheus 监控** | `9090` | HTTP | 指标收集 | `prometheus.yml` |
| **Grafana 仪表板** | `3000` | HTTP | 可视化监控 (默认) | 外部配置 |

---

## 🗄️ 数据库配置详情

### MySQL 数据库配置

```yaml
# 数据库连接信息
Host: localhost
Port: 3306
Database: mambo_code_platform
Username: root
Password: 810271689
```

**连接字符串:**

```
jdbc:mysql://localhost:3306/mambo_code_platform?useUnicode=true&characterEncoding=UTF-8&serverTimezone=UTC
```

**重要配置项:**
- 字符编码: `UTF-8`
- 时区设置: `UTC`
- Unicode 支持: `启用`

### Redis 缓存配置

```yaml
# Redis 连接信息
Host: localhost
Port: 6379
Password: (无密码)
Database: 1
TTL: 3600 秒 (1小时)
```

```java
// 注意，本地环境使用的redis是没有密码的，而生产环境使用的redis是有密码的
@Configuration
@ConfigurationProperties(prefix = "spring.data.redis")
@Data
public class RedisChatMemoryStoreConfig {

    private String host;

    private int port;

    private String password;

    private long ttl;

    @Bean
    public RedisChatMemoryStore redisChatMemoryStore() {
        RedisChatMemoryStore.Builder builder = RedisChatMemoryStore.builder()
                .host(host)
                .port(port)
                .password(password)
                .ttl(ttl);
        //本地环境使用需注释
        if (StrUtil.isNotBlank(password)) {
            builder.user("default");
        }
        return builder.build();
    }
}
```



**用途说明:**

- **会话存储**: Spring Session 数据持久化
- **LangChain4j 聊天记忆**: AI 对话历史缓存
- **应用缓存**: 提升系统性能

---

## 🌐 前后端地址规划

### 后端服务地址规划

| 环境 | 基础URL | Context Path | 完整地址 |
|------|---------|--------------|----------|
| **开发环境** | `http://localhost:8234` | `/api` | `http://localhost:8234/api` |
| **生产环境** | `http://your-domain.com:8234` | `/api` | `http://your-domain.com:8234/api` |

### 前端服务地址规划

| 环境 | 基础URL | 代理配置 | 说明 |
|------|---------|----------|------|
| **开发环境** | `http://localhost:5173` | 代理到 `localhost:8234` | Vite 开发服务器 |
| **生产环境** | `http://your-domain.com` | 反向代理配置 | Nginx/Apache 配置 |

### API 接口规划

| 接口类型 | 路径前缀 | 完整地址示例 | 说明 |
|----------|----------|--------------|------|
| **RESTful API** | `/api/v1` | `http://localhost:8234/api/v1/apps` | 业务接口 |
| **WebSocket** | `/api/ws` | `ws://localhost:8234/api/ws` | 实时通信 |
| **文件上传** | `/api/upload` | `http://localhost:8234/api/upload` | 文件服务 |
| **健康检查** | `/api/actuator/health` | `http://localhost:8234/api/actuator/health` | 监控端点 |

---

## 📊 监控与可观测性

### Prometheus 监控配置

```yaml
# Prometheus 服务地址
URL: http://localhost:9090
Job Name: mambo-ai-platform
Scrape Path: /api/actuator/prometheus
Target: localhost:8234
Scrape Interval: 10 秒
```

### Grafana 仪表板

```yaml
# Grafana 服务地址 (默认)
URL: http://localhost:3000
数据源: Prometheus (http://localhost:9090)
仪表板配置: ./grafana/ai_model_grafana_config.json
```

### Spring Boot Actuator 端点

| 端点 | 路径 | 用途 |
|------|------|------|
| **健康检查** | `/api/actuator/health` | 服务健康状态 |
| **信息端点** | `/api/actuator/info` | 应用信息 |
| **Prometheus 指标** | `/api/actuator/prometheus` | 性能指标 |

---

## 🔗 外部服务配置

### 阿里云 OSS 存储

```yaml
# OSS 配置信息
Endpoint: https://oss-cn-chengdu.aliyuncs.com
Region: cn-chengdu
Bucket: codeplatform
Access Key ID: LTAI5t8hbFQcqbkNrTCXzPqr
Access Key Secret: [配置在环境变量中]
```

### ModelScope AI 服务

```yaml
# AI 模型服务配置
Base URL: https://api-inference.modelscope.cn/v1/
API Key: ms-b0da3e8e-b54a-4026-9e92-578c202c6e12
超时设置: 10分钟
最大令牌数: 8192-32768 (根据模型不同)
```

---

## 🔧 开发环境启动指南

### 后端服务启动

```bash
# 启动 Spring Boot 应用 (使用 local 配置)
mvn spring-boot:run -Dspring.profiles.active=local

# 应用将在以下地址启动:
# http://localhost:8234/api
```

### 前端服务启动

```bash
# 进入前端目录
cd mambo-ai-platform-frontend

# 启动开发服务器
npm run dev

# 前端将在以下地址启动:
# http://localhost:5173
```

### 必需的基础服务

```bash
# 启动 MySQL (确保运行在 3306 端口)
sudo systemctl start mysql

# 启动 Redis (确保运行在 6379 端口)
sudo systemctl start redis-server

# 启动 Prometheus (可选，用于监控)
./prometheus --config.file=prometheus.yml
```

---

## 🚨 端口冲突解决方案

### 常见端口冲突及解决方案

| 端口 | 可能冲突的服务 | 解决方案 |
|------|----------------|----------|
| `8234` | 其他 Spring Boot 应用 | 修改 `application.yml` 中的 `server.port` |
| `5173` | 其他 Vite 应用 | 修改 `vite.config.ts` 或使用 `--port` 参数 |
| `3306` | 其他 MySQL 实例 | 修改 MySQL 配置或使用不同端口 |
| `6379` | 其他 Redis 实例 | 修改 Redis 配置文件 |
| `9090` | 其他 Prometheus 实例 | 修改 Prometheus 启动参数 |

### 端口检查命令

```bash
# 检查端口占用情况 (Windows)
netstat -ano | findstr :8234
netstat -ano | findstr :5173
netstat -ano | findstr :3306
netstat -ano | findstr :6379
netstat -ano | findstr :9090

# 检查端口占用情况 (Linux/Mac)
lsof -i :8234
lsof -i :5173
lsof -i :3306
lsof -i :6379
lsof -i :9090
```

---

## 🔐 安全配置说明

### 会话配置

```yaml
# Session 安全配置
Store Type: Redis
Timeout: 30天 (2592000秒)
Cookie Max Age: 30天
Context Path: /api
```

### 数据库安全

- **MySQL**: 使用强密码，限制远程访问
- **Redis**: 建议在生产环境配置密码认证
- **OSS**: Access Key 通过环境变量配置，避免硬编码

---

## 📝 部署注意事项

### 生产环境配置

1. **数据库连接池**: 配置合适的连接池大小
2. **Redis 持久化**: 启用 RDB 或 AOF 持久化
3. **反向代理**: 使用 Nginx 作为前端反向代理
4. **SSL 证书**: 生产环境启用 HTTPS
5. **防火墙**: 仅开放必要的端口

### 负载均衡配置

```nginx
# Nginx 配置示例
upstream backend {
    server localhost:8234;
    # server localhost:8235;  # 多实例负载均衡
}

server {
    listen 80;
    server_name your-domain.com;

    location /api/ {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location / {
        root /path/to/frontend/dist;
        try_files $uri $uri/ /index.html;
    }
}
```

---

## 📞 联系与维护

- **项目名称**: Mambo AI Platform
- **技术栈**: Spring Boot 3 + Vue 3 + LangChain4j
- **文档更新**: 请在配置变更时及时更新本文档
- **配置文件位置**:
  - 后端: `src/main/resources/application*.yml`
  - 前端: `vite.config.ts`
  - 监控: `prometheus.yml`

---

## 📝 维护记录

| 日期 | 修改内容 | 责任人 |
|------|----------|--------|
| 2025-08-19 | 创建端口规划文档 | System |
| 2025-08-19 | 修复MonitorContext NPE错误 | System |
| 2025-08-19 | 添加JVM优化配置 | System |
| 2025-08-19 | 完善云服务器部署信息 | System |
| 2025-08-19 | **修复HTTP连接断开错误** | System |
| 2025-08-19 | **修复SSE流处理错误** | System |
| 2025-08-19 | **添加监控上下文自动管理** | System |
| 2025-08-19 | **优化LangChain4j HTTP配置** | System |

---

*最后更新: 2025-08-19 13:30*
